# Nginx Configuration for Linux passwd File Viewer
# Add this to your Nginx server block

server {
    listen 80;
    server_name your-domain.com;
    root /var/www/html;
    index index.html index.htm;
    
    # Basic CORS headers for all requests
    add_header Access-Control-Allow-Origin *;
    add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
    add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept";
    
    # Handle preflight OPTIONS requests
    if ($request_method = 'OPTIONS') {
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods "GET, POST, OPTIONS";
        add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept";
        add_header Content-Length 0;
        add_header Content-Type text/plain;
        return 204;
    }
    
    # Serve passwd file with proper headers
    location ~ ^/(passwd|passwd-live|group-live)$ {
        add_header Access-Control-Allow-Origin *;
        add_header Cache-Control "no-cache, must-revalidate";
        try_files $uri =404;
    }
    
    # Direct /etc access (SECURITY WARNING - use with extreme caution)
    # Uncomment only if you understand the security implications
    #location /etc/ {
    #    alias /etc/;
    #    autoindex on;
    #    add_header Access-Control-Allow-Origin *;
    #    add_header Access-Control-Allow-Methods "GET, OPTIONS";
    #    add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept";
    #    
    #    if ($request_method = 'OPTIONS') {
    #        return 204;
    #    }
    #}
    
    # Security headers (recommended)
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options DENY;
    add_header X-XSS-Protection "1; mode=block";
    
    # Default location
    location / {
        try_files $uri $uri/ =404;
    }
}